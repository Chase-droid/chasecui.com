<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Music | Chase Cui</title>
    <link rel="stylesheet" href="music.css" />
</head>

<body>
    <header class="nav">
        <a class="brand" href="#top">Chase</a>
        <nav class="menu">
            <a href="music.html">Music</a>
            <a href="movies.html">Movies</a>
            <a href="tv.html">TV</a>
            <a href="books.html">Books</a>
            <a href="travels.html">Travels</a>
            <a href="career.html">Career</a>
        </nav>
        <a class="contact-btn" href="contact.html">Contact</a>
    </header>

    <section class="hero">
        <h1>My Music Corner</h1>
        <p>Where words fail, music speaks.</p>
    </section>

    <section class="playlist">
        <h2>My Spotify Playlist</h2>
        <iframe style="border-radius:12px"
            src="https://open.spotify.com/embed/playlist/0orYRJhsZs1pV8TUWUG3Tv?utm_source=generator" width="100%"
            height="352" frameborder="0" allowfullscreen=""
            allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy">
        </iframe>
    </section>

    <section class="quiz">
        <h2>Guess Game</h2>

        <!-- Q1 -->
        <div class="q-block" data-question-id="q1">
            <h3>Guess my favourite DJ/producer</h3>
            <div class="options" role="group" aria-label="Favourite DJ/producer">
                <!-- Add imageUrl to show avatars -->
                <label class="card">
                    <input type="radio" name="q1" value="avicii" />
                    <div class="card-body">
                        <div class="avatar" data-img=""></div>
                        <span>Avicii</span>
                    </div>
                </label>
                <label class="card">
                    <input type="radio" name="q1" value="zedd" />
                    <div class="card-body">
                        <div class="avatar" data-img=""></div>
                        <span>Zedd</span>
                    </div>
                </label>
                <label class="card">
                    <input type="radio" name="q1" value="alesso" />
                    <div class="card-body">
                        <div class="avatar" data-img=""></div>
                        <span>Alesso</span>
                    </div>
                </label>
                <label class="card">
                    <input type="radio" name="q1" value="david guetta" />
                    <div class="card-body">
                        <div class="avatar" data-img=""></div>
                        <span>David Guetta</span>
                    </div>
                </label>
            </div>
            <button class="submit-btn" data-for="q1">Submit</button>
            <p class="result"></p>
        </div>

        <!-- Q2 -->
        <div class="q-block" data-question-id="q2">
            <h3>Guess my first concert</h3>
            <div class="options" role="group" aria-label="First concert">
                <label class="card">
                    <input type="radio" name="q2" value="taylor swift" />
                    <div class="card-body">
                        <div class="avatar" data-img=""></div>
                        <span>Taylor Swift</span>
                    </div>
                </label>
                <label class="card">
                    <input type="radio" name="q2" value="lady gaga" />
                    <div class="card-body">
                        <div class="avatar" data-img=""></div>
                        <span>Lady Gaga</span>
                    </div>
                </label>
                <label class="card">
                    <input type="radio" name="q2" value="rihanna" />
                    <div class="card-body">
                        <div class="avatar" data-img=""></div>
                        <span>Rihanna</span>
                    </div>
                </label>
                <label class="card">
                    <input type="radio" name="q2" value="katy perry" />
                    <div class="card-body">
                        <div class="avatar" data-img=""></div>
                        <span>Katy Perry</span>
                    </div>
                </label>
            </div>
            <button class="submit-btn" data-for="q2">Submit</button>
            <p class="result"></p>
        </div>

        <!-- Q3 -->
        <div class="q-block" data-question-id="q3">
            <h3>Guess my most streamed artist</h3>
            <div class="options" role="group" aria-label="Most streamed artist">
                <label class="card">
                    <input type="radio" name="q3" value="lady gaga" />
                    <div class="card-body">
                        <div class="avatar" data-img=""></div>
                        <span>Lady Gaga</span>
                    </div>
                </label>
                <label class="card">
                    <input type="radio" name="q3" value="the weeknd" />
                    <div class="card-body">
                        <div class="avatar" data-img=""></div>
                        <span>The Weeknd</span>
                    </div>
                </label>
                <label class="card">
                    <input type="radio" name="q3" value="the 1975" />
                    <div class="card-body">
                        <div class="avatar" data-img=""></div>
                        <span>The 1975</span>
                    </div>
                </label>
                <label class="card">
                    <input type="radio" name="q3" value="taylor swift" />
                    <div class="card-body">
                        <div class="avatar" data-img=""></div>
                        <span>Taylor Swift</span>
                    </div>
                </label>
            </div>
            <button class="submit-btn" data-for="q3">Submit</button>
            <p class="result"></p>
        </div>
    </section>

    <section class="recommend">
        <h2>Recommend a Song</h2>
        <p>Share a song with me ‚Äî I might add it to my playlist.</p>

        <form id="recommendForm">
            <input type="text" id="name" name="name" placeholder="Your name (optional)">
            <input type="text" id="song" name="song" placeholder="Song title *" required>
            <input type="text" id="artist" name="artist" placeholder="Artist (optional)">
            <textarea id="message" name="message" placeholder="Why this song? (optional)"></textarea>

            <button type="submit" id="recommendSubmit">Send Recommendation</button>
        </form>

        <p id="recommendResult"></p>
    </section>


    <footer>
        <p>¬© 2025 Chase Cui | Made with ‚ù§Ô∏è and good music</p>
    </footer>

    <script>

        async function loadArtistImages() {
            const artistSpotifyId = {
                "avicii": "1vCWHaC5f2uS3yhpwWbIA6",
                "zedd": "2qxJFvFYMEDqd7ui6kSAcq",
                "alesso": "4AVFqumd2ogHFlRbKIjp1t",
                "david guetta": "1Cs0zKBU1kc0i8ypK3B9ai",
                "taylor swift": "06HL4z0CvFAxyc27GXpf02",
                "lady gaga": "1HY2Jd0NmPuamShAr6KMms",
                "rihanna": "5pKCCKE2ajJHZ9KAiaK11H",
                "katy perry": "6jJ0s89eD6GaHleKKya26X",
                "the weeknd": "1Xyo4u8uXC1ZmMpatF05PJ",
                "the 1975": "3mIj9lX2MWuHmhNCA7LSCW"
            };

            const API_BASE =
                "https://fai7vl64bh.execute-api.ap-southeast-6.amazonaws.com/prod";

            for (const [name, id] of Object.entries(artistSpotifyId)) {
                try {
                    const res = await fetch(`${API_BASE}/artist/${id}`);

                    if (!res.ok) {
                        throw new Error(`HTTP ${res.status}`);
                    }

                    const data = await res.json();
                    const imgUrl = data.images?.[0]?.url || "";

                    document.querySelectorAll(`input[value='${name}']`).forEach((input) => {
                        const avatar = input.closest(".card").querySelector(".avatar");
                        if (imgUrl && avatar) {
                            avatar.style.backgroundImage = `url('${imgUrl}')`;
                            avatar.classList.add("has-img");
                        }
                    });
                } catch (err) {
                    console.error("Failed loading", name, err);
                }
            }

        }


        // ÁΩëÈ°µÂä†ËΩΩÂêéËøêË°å
        loadArtistImages();

        // Set correct answers here (change anytime)
        const correct = {
            q1: "alesso",        // favourite DJ/producer
            q2: "lady gaga",     // first concert
            q3: "the weeknd"      // most streamed artist
        };

        // Optional: plug in image URLs (Spotify, Wikipedia, your own host, etc.)
        // Leave as "" to show text-only cards.
        const imageMap = {
            "avicii": "",
            "zedd": "",
            "alesso": "",
            "david guetta": "",
            "taylor swift": "",
            "lady gaga": "",
            "rihanna": "",
            "katy perry": "",
            "the weeknd": "",
            "the 1975": ""
        };

        // Apply avatar images if provided
        document.querySelectorAll(".avatar").forEach((el) => {
            const label = el.closest("label");
            const input = label.querySelector("input[type='radio']");
            const key = input.value.toLowerCase();
            const url = imageMap[key] || el.dataset.img || "";
            if (url) {
                el.style.setProperty("--avatar", `url('${url}')`);
                el.classList.add("has-img");
            }
        });

        // Selection styling
        document.querySelectorAll(".card input[type='radio']").forEach((radio) => {
            radio.addEventListener("change", () => {
                const group = radio.name;
                document.querySelectorAll(`input[name='${group}']`).forEach(r => {
                    r.closest(".card").classList.toggle("selected", r.checked);
                });
            });
        });

        // Handle submits
        document.querySelectorAll(".submit-btn").forEach((btn) => {
            btn.addEventListener("click", () => {
                const qid = btn.dataset.for;
                const picked = document.querySelector(`input[name='${qid}']:checked`);
                const result = btn.parentElement.querySelector(".result");

                result.classList.remove("correct", "wrong", "fade-in", "shake");

                if (!picked) {
                    result.textContent = "Pick one option first.";
                    result.classList.add("fade-in");
                    return;
                }

                const isCorrect = picked.value.toLowerCase() === correct[qid].toLowerCase();
                if (isCorrect) {
                    result.textContent = "üéâ Correct!";
                    result.classList.add("correct", "fade-in");
                    // celebration pulse on the chosen card
                    const card = picked.closest(".card");
                    card.classList.remove("pulse");
                    void card.offsetWidth; // restart animation
                    card.classList.add("pulse");
                } else {
                    result.textContent = "Not quite ‚Äî try again!";
                    result.classList.add("wrong", "shake");
                    // subtle shake on the chosen card
                    const card = picked.closest(".card");
                    card.classList.remove("shake-card");
                    void card.offsetWidth;
                    card.classList.add("shake-card");
                }
            });
        });

        // Recommendation interaction
        document.addEventListener("DOMContentLoaded", function () {
            const form = document.getElementById("recommendForm");
            const result = document.getElementById("recommendResult");
            const submitBtn = document.getElementById("recommendSubmit");

            if (!form) return;

            form.addEventListener("submit", async function (event) {
                event.preventDefault();

                const payload = {
                    name: document.getElementById("name").value.trim(),
                    song: document.getElementById("song").value.trim(),
                    artist: document.getElementById("artist").value.trim(),
                    message: document.getElementById("message").value.trim(),
                };

                if (!payload.song) {
                    result.textContent = "Song title is required.";
                    return;
                }

                submitBtn.disabled = true;
                result.textContent = "Submitting...";

                try {
                    const response = await fetch("https://ok2h8dvk9d.execute-api.ap-southeast-6.amazonaws.com/prod/recommendations", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify(payload),
                    });

                    const data = await response.json();

                    if (response.ok && data.success) {
                        result.textContent = "Thank you! Your recommendation has been saved.";
                        form.reset();
                    } else {
                        console.error("API error:", data);
                        result.textContent = data.error || "Something went wrong, please try again.";
                    }
                } catch (err) {
                    console.error("Network error:", err);
                    result.textContent = "Network error, please try again later.";
                } finally {
                    submitBtn.disabled = false;
                }

            });
        });


    </script>
</body>

</html>